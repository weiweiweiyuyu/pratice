<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>async/await</title>
</head>

<body>
    <script>
        // 1ã€async è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawaitè¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœ
        async function asyncFn() {
            return 'hello world'
        }
        // console.log(asyncFn()); //PromiseÂ {<fulfilled>: 'hello world'}

        //2ã€asyncå®šä¹‰[å¼‚æ­¥å‡½æ•°]
        async function asyncFn1() {
            return 'æˆ‘åæ‰§è¡Œ';
        }
        asyncFn1().then(result => {
            console.log(result)
        })
        console.log("æˆ‘å…ˆæ‰§è¡Œ")

        //3ã€asyncå®šä¹‰çš„å‡½æ•°å†…éƒ¨é»˜è®¤è¿”å›ä¸€ä¸ª[promiseå¯¹è±¡]ï¼Œå¦‚æœå‡½æ•°
        // å†…éƒ¨æŠ›å‡ºå¼‚å¸¸æˆ–è€…æ˜¯è¿”å›rejectï¼Œéƒ½ä¼šä½¿å‡½æ•°çš„promiseçš„çŠ¶æ€ä¸ºå¤±è´¥reject
        async function e() {
            throw new Error("has error");
        }
        e().then(success => console.log("æˆåŠŸ", success))
            .catch(error => console.log("å¤±è´¥", error))

        //4ã€asyncå‡½æ•°æ¥æ”¶åˆ°è¿”å›çš„å€¼ï¼Œå‘ç°ä¸æ˜¯å¼‚å¸¸æˆ–è€…reject,åˆ™åˆ¤å®šæˆåŠŸï¼Œè¿™é‡Œå¯ä»¥return å„ç§ç±»å‹çš„å€¼
        // falseã€NaNã€undefined...æ€»ä¹‹éƒ½æ˜¯resolve
        async function throwStatus() {
            return 'å¯ä»¥è¿”å›æ‰€æœ‰ç±»å‹çš„å€¼'
        }
        throwStatus().then(success => console.log('æˆåŠŸ', success))
            .catch(error => console.log('å¤±è´¥', error));

        // 5ã€è¿”å›å¦‚ä¸‹ç»“æœä¼šä½¿asyncå‡½æ•°åˆ¤å®šå¤±è´¥
        //(1)å†…éƒ¨å«æœ‰ç›´æ¥ä½¿ç”¨å¹¶ä¸”æœªå£°æ˜çš„å˜é‡æˆ–è€…å‡½æ•°ã€‚
        //(2)å†…éƒ¨æŠ›å‡ºä¸€ä¸ªé”™è¯¯throw new Erroræˆ–è€…è¿”å›rejectçŠ¶æ€return Promise.reject('æ‰§è¡Œå¤±è´¥')
        //(3)å‡½æ•°æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼ˆğŸŒ°ï¼šObjectä½¿ç”¨push()ï¼‰ç­‰ç­‰...
        async function throwError() {
            return Promise.reject("æ‰§è¡Œå¤±è´¥")
            // return Promise.resolve("hahahæˆåŠŸ")
        }
        throwError().then(success => console.log('æˆåŠŸ', success))
            .catch(error => console.log('å¤±è´¥', error));

        async function throwError2() {
            //æœªå£°æ˜
            return msg;

        }
        throwError2().then(success => console.log('æˆåŠŸ', success))
            .catch(error => console.log('å¤±è´¥', error));

        //6ã€åœ¨asyncé‡Œï¼Œå¿…é¡»è¦å°†ç»“æœreturn å›æ¥ï¼Œä¸ç„¶çš„è¯ä¸ç®¡æ˜¯æ‰§è¡Œrejectè¿˜æ˜¯resolveçš„å€¼éƒ½ä¸ºundefined
        async function PromiseError() {
            return Promise.reject('has Promise Error'); 
            // Promise.reject('è¿™æ˜¯é”™è¯¯çš„åšæ³•');
        }

        PromiseError().then(success => console.log('æˆåŠŸ', success)) //æˆåŠŸ undefined
            .catch(error => console.log('å¤±è´¥', error));
    </script>

</body>

</html>